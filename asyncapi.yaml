asyncapi: 3.0.0
info:
  title: Regel - Rätt till VAH-försäkring
  version: 1.1.0
  description: Regel för att kontrollera om en person har rätt till Vård av husdjur.

channels:
  vah.rtf.requests:
    address: vah.rtf.requests
    messages:
      VahRtfRequestMessage:
        $ref: "#/components/messages/VahRtfRequestMessage"

  vah.rtf.responses:
    address: vah.rtf.responses
    messages:
      VahRtfResponseMessage:
        $ref: "#/components/messages/VahRtfResponseMessage"

operations:
  onVahRtfRequest:
    action: receive
    summary: Tillämpar regeln och kontrollerar om personen har rätt till Vård av husdjur.
    channel:
      $ref: "#/channels/vah.rtf.requests"
    reply:
      address:
        description: Resultatet skickas tillbaka till källan.
        location: "$message.header#/replyTo"
      channel:
        $ref: "#/channels/vah.rtf.responses"

components:
  messages:
    VahRtfRequestMessage:
      headers:
        $ref: "#/components/schemas/VahRtfRequestMessageHeaders"
      payload:
        title: VahRtfRequestMessagePayload
        allOf:
          - $ref: "kogito-cloudevent.yaml#/components/schemas/KogitoCloudEvent"
          - type: object
            properties:
              type:
                type: string
                const: vah-rtf-requests
                default: vah-rtf-requests
              data:
                $ref: "#/components/schemas/VahRtfRequestMessageData"
    VahRtfResponseMessage:
      headers:
        $ref: "#/components/schemas/VahRtfResponseMessageHeaders"
      payload:
        title: VahRtfResponseMessagePayload
        allOf:
          - $ref: "kogito-cloudevent.yaml#/components/schemas/KogitoCloudEvent"
          - type: object
            properties:
              type:
                type: string
                const: vah-rtf-responses
                default: vah-rtf-responses
              data:
                $ref: "#/components/schemas/VahRtfResponseMessageData"
  schemas:
    VahRtfRequestMessageHeaders:
      type: object
      properties:
        replyTo:
          type: string
          description: Topic där response ska skickas
        correlationId:
          type: string
          description: Unikt id som kopplar ihop request & response
    VahRtfRequestMessageData:
      title: VahRtfRequestMessageData
      type: object
      properties:
        processId:
          type: string
          description: Unikt id som identifierar processinstansen
        personNummer:
          type: string
          description: Svenskt personnummer, 12 siffror med bindestreck (YYYYMMDD-XXXX)
          pattern: '^\d{8}-\d{4}$'
          example: 19990101-0123
    VahRtfResponseMessageHeaders:
      type: object
      properties:
        correlationId:
          type: string
          description: Unikt id som kopplar ihop request & response
    VahRtfResponseMessageData:
      title: VahRtfResponseMessageData
      type: object
      properties:
        processId:
          type: string
          description: Unikt id som identifierar processinstansen
        personNummer:
          type: string
          description: Svenskt personnummer, 12 siffror med bindestreck (YYYYMMDD-XXXX)
          pattern: '^\d{8}-\d{4}$'
          example: 19990101-0123
        rattTillForsakring:
          title: rattTillForsakring
          type: string
          description: Utfall av regel, om personen har rätt till försäkring
          enum:
            - Ja
            - Nej
            - Utredning
          example: Ja
